# Инструкция по настройке автоматического развертывания

## Необходимые GitHub Secrets

Для работы автоматического развертывания в Yandex Object Storage необходимо настроить следующие секреты в репозитории:

### Как добавить секреты:
1. Откройте страницу репозитория на GitHub
2. Перейдите в **Settings** → **Secrets and variables** → **Actions**
3. Нажмите **New repository secret**
4. Добавьте каждый из следующих секретов:

### Список необходимых секретов:

#### `YC_KEY_ID`
- **Описание**: Access Key ID для доступа к Yandex Object Storage
- **Где получить**:
  1. Перейдите в [Yandex Cloud Console](https://console.cloud.yandex.ru/)
  2. Выберите сервис **Object Storage**
  3. Перейдите в раздел **Сервисные аккаунты**
  4. Создайте новый сервисный аккаунт или используйте существующий
  5. Создайте статический ключ доступа
  6. Скопируйте **Идентификатор ключа**

#### `YC_SECRET_KEY`
- **Описание**: Secret Access Key для доступа к Yandex Object Storage
- **Где получить**:
  - При создании статического ключа (см. выше) скопируйте **Секретный ключ**
  - ⚠️ **Важно**: Секретный ключ показывается только один раз при создании!

#### `YC_BUCKET_NAME`
- **Описание**: Имя бакета в Yandex Object Storage
- **Пример**: `pleskad.ru`
- **Где получить**:
  1. В [Yandex Cloud Console](https://console.cloud.yandex.ru/) откройте **Object Storage**
  2. Создайте новый бакет или используйте существующий
  3. Используйте имя бакета в качестве значения секрета

### Настройка бакета в Yandex Object Storage

Для корректной работы сайта настройте бакет следующим образом:

1. **Доступ**: Публичный (для чтения)
2. **Website hosting**: Включен
   - Index document: `index.html`
   - Error document: `index.html` (для SPA)
3. **CORS** (если требуется): Настройте правила CORS

## Процесс развертывания

После настройки секретов развертывание происходит автоматически:

1. **Автоматический деплой**: При каждом push в ветку `main`
2. **Ручной запуск**: Через вкладку **Actions** → **Deploy to Yandex Object Storage** → **Run workflow**

## Структура workflow

Workflow выполняет следующие шаги:

1. ✅ Checkout кода
2. ✅ Установка Node.js и зависимостей
3. ✅ Инжекция переменных окружения в конфигурацию
4. ✅ Сборка статического сайта (`npm run generate`)
5. ✅ Развертывание файлов с правильными Content-Type headers
6. ✅ Настройка кэширования для разных типов файлов

## URL сайта после развертывания

После успешного развертывания сайт будет доступен по адресу:
```
https://{YC_BUCKET_NAME}.storage.yandexcloud.net
```

Или через ваш собственный домен, если он настроен для бакета.

## Проверка статуса развертывания

1. Перейдите во вкладку **Actions** в репозитории
2. Выберите последний запуск **Deploy to Yandex Object Storage**
3. Проверьте логи выполнения

## Устранение неполадок

### Ошибка "Access Denied"
- Проверьте правильность `YC_KEY_ID` и `YC_SECRET_KEY`
- Убедитесь, что сервисный аккаунт имеет права на запись в бакет

### Ошибка "Bucket not found"
- Проверьте правильность `YC_BUCKET_NAME`
- Убедитесь, что бакет существует в Yandex Object Storage

### Файлы загружены, но сайт не работает
- Проверьте настройки **Website hosting** в бакете
- Убедитесь, что доступ к бакету настроен как **Публичный**
